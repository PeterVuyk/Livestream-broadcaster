{% extends "base.html.twig" %}
{% trans_default_domain 'JMoseCommandScheduler' %}
{% set active_page = 'recurring_schedule' %}
{% block title %}{{ 'recurring_scheduler.list.title'|trans }}{% endblock title %}
{% block pageTitle %}{{ 'recurring_scheduler.list.title'|trans }}{% endblock pageTitle %}

{% block content %}
    <div class="table-responsive table-stripped">
    <table class="table">
        <thead>
            <tr>
                <th>&nbsp;</th>
                <th>{{ "recurring_scheduler.list.detail.name"|trans }}</th>
                <th>{{ "recurring_scheduler.list.detail.command"|trans }}</th>
                <th>{{ "recurring_scheduler.list.detail.cronExpression"|trans }}</th>
                <th>{{ "recurring_scheduler.list.detail.logFile"|trans }}</th>
                <th>{{ "recurring_scheduler.list.detail.nextExecution"|trans }}</th>
                <th>{{ "recurring_scheduler.list.detail.lastExecution"|trans }}</th>
                <th>{{ "recurring_scheduler.list.detail.lastReturnCode"|trans }}</th>
                <th>{{ "recurring_scheduler.list.detail.priority"|trans }}</th>
                <th>{{ "recurring_scheduler.list.detail.actions"|trans }}</th>
            </tr>
        </thead>

        <tbody>
        {% for command in scheduledCommands %}
            <tr {% if command.disabled == true %}class="text-muted" {% endif %}>
                <td>
                    <a href="{{ path('jmose_command_scheduler_action_toggle', {'id': command.id}) }}" >
                    {% if command.disabled == true %}
                        <span class="text-danger glyphicon glyphicon-off"></span> <span class="sr-only">&nbsp;</span>
                    {% else %}
                        <span class="text-success glyphicon glyphicon-off"></span> <span class="sr-only">&nbsp;</span>
                    {% endif %}
                    </a>
                </td>
                <td>{{ command.name }}</td>
                <td>{{ command.command }} {{ command.arguments }}</td>
                <td>{{ command.cronExpression }}</td>
                <td>{{ command.logFile }}</td>
                <td>{% if command.disabled == true %}&nbsp;-&nbsp;{% else %}{{ cronExpression('* * * * 6') }}{% endif %}</td>
                <td>{{ command.lastExecution|date("D M j, G:i:s", "Europe/Amsterdam") }}</td>
                <td>{{ command.lastReturnCode }}</td>
                <td>{{ command.priority }}</td>
                <td style="min-width: 90px;">
                    {% if command.locked == true %}
                        <a href="#js-unlock-scheduled-modal-{{ command.id }}" data-toggle="modal">
                            <span class="text-muted glyphicon glyphicon-lock"></span> <span class="sr-only">{{ "action.unlock"|trans }}</span>
                        </a>
                    {{ include('components/modal/recurringScheduler/unlockModal.html.twig') }}

                    {% endif %}
                    <a href="{{ path('jmose_command_scheduler_detail_edit', {'scheduledCommandId': command.id}) }}" >
                        <span class="text-info glyphicon glyphicon-pencil"></span> <span class="sr-only">{{ "action.edit"|trans }}</span>
                    </a>

                    <a href="#js-delete-scheduled-modal-{{ command.id }}" data-toggle="modal">
                        <span class="text-danger glyphicon glyphicon-trash"></span>
                    </a>
                    {{ include('components/modal/recurringScheduler/deleteModal.html.twig') }}

                    <a href="#js-execute-scheduled-modal-{{ command.id }}" data-toggle="modal">
                        <span class="text-{% if command.executeImmediately == true %}muted{% else %}success{% endif %} glyphicon glyphicon-play"></span>
                    </a>
                    {{ include('components/modal/recurringScheduler/executeModal.html.twig') }}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
    <a href="{{ path('jmose_command_scheduler_detail_new') }}" class="btn btn-primary btn-lg pull-right" role="button">{{ "action.recurring_new"|trans }}</a>
{% endblock content %}
