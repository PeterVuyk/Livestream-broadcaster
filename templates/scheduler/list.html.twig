{% extends "base.html.twig" %}
{% set active_page = 'schedule' %}
{% trans_default_domain 'schedule_list' %}
{% block title %}{{ 'scheduler_list.title'|trans }}{% endblock title %}
{% block pageTitle %}{{ 'scheduler_list.title'|trans }}{% endblock pageTitle %}

{% block content %}
    <div class="table-responsive table-stripped">
    <table class="table">
        <thead>
            <tr>
                <th>&nbsp;</th>
                <th>{{ "scheduler_list.column.name"|trans }}</th>
                <th>{{ "scheduler_list.column.command"|trans }}</th>
                <th>{{ "scheduler_list.column.scheduledExecution"|trans }}</th>
                <th>{{ "scheduler_list.column.lastExecution"|trans }}</th>
                <th>{{ "scheduler_list.column.logging"|trans }}</th>
                <th>{{ "scheduler_list.column.priority"|trans }}</th>
                <th>{{ "scheduler_list.column.actions"|trans }}</th>
            </tr>
        </thead>

        <tbody>
        {% for scheduledItem in scheduledItems %}
            <tr class="{% if scheduledItem.disabled == true %} text-muted{% endif %}">
                <td>
                    <a href="{{ path('scheduler_toggle_disabling', {'scheduleId': scheduledItem.id}) }}" >
                    {% if scheduledItem.disabled == true %}
                        <span class="text-danger fa fa-power-off fa-lg"></span> <span class="sr-only">&nbsp;</span>
                    {% else %}
                        <span class="text-success fa fa-power-off fa-lg"></span> <span class="sr-only">&nbsp;</span>
                    {% endif %}
                    </a>
                </td>
                <td>{{ scheduledItem.name }}</td>
                <td>{{ scheduledItem.command }}</td>
                <td>
                    {% if scheduledItem.runWithNextExecution == true %}
                        {{ 'scheduler_list.run_with_next_execution'|trans }}
                    {% else %}
                        {{ 'scheduler_list.recurring_time_prefix'|trans }}&nbsp;
                        {{ scheduledItem.executionDay|trans|lower }}&nbsp;
                        {{ 'scheduler_list.recurring_time_at'|trans }}&nbsp;
                        {{ scheduledItem.executionTime|date("G:i", "Europe/Amsterdam") }}
                    {% endif %}
                </td>
                <td>
                    {% if scheduledItem.lastExecution is null %}-{% else %}{{ scheduledItem.lastExecution|date("D M j, G:i:s", "Europe/Amsterdam") }}{% endif %}
                    {% set scheduleLog = scheduledItem.scheduleLog|first ? scheduledItem.scheduleLog|first : null %}
                    {% if scheduleLog is not null and scheduleLog.runSuccessful == true %}
                        <span class="fa fa-check text-center text-success fa-lg"></span>
                    {% elseif scheduleLog is not null and scheduleLog.runSuccessful == false %}
                            <span class="fa fa-warning text-danger fa-lg"></span>
                    {% endif %}
                </td>
                <td>
                    {% if scheduleLog is not null %}
                        <a href="{{ path('scheduler_view_logging', {'scheduleId': scheduledItem.id}) }}">
                            <span class="fa fa-eye fa-lg"></span>
                        </a>
                    {% endif %}
                </td>
                <td>{{ scheduledItem.priority }}</td>
                <td style="min-width: 90px;">
                    {% if scheduledItem.wrecked == true and scheduleLog is not null and scheduleLog.runSuccessful == false %}
                        <a href="#js-rerun-failed-schedule-modal-{{ scheduledItem.id }}" data-toggle="modal">
                            <span class="fa fa-undo text-warning fa-lg"></span>
                        </a>
                        {{ include('scheduler/modal/rerunFailedModal.html.twig') }}
                    {% endif %}
                    <a href="{{ path('scheduler_edit', {'scheduleId': scheduledItem.id}) }}" >
                        <span class="text-info fa fa-edit fa-lg"></span> <span class="sr-only">{{ "schedule.action.edit"|trans }}</span>
                    </a>

                    <a href="#js-delete-scheduled-modal-{{ scheduledItem.id }}" data-toggle="modal">
                        <span class="text-danger fa fa-trash fa-lg"></span>
                    </a>
                    {{ include('scheduler/modal/deleteModal.html.twig') }}

                    <a href="#js-execute-scheduled-modal-{{ scheduledItem.id }}" data-toggle="modal">
                        <span class="text-{% if scheduledItem.runWithNextExecution == true %}muted{% else %}success{% endif %} fa fa-play fa-lg"></span>
                    </a>
                    {{ include('scheduler/modal/executeModal.html.twig') }}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
    <a href="{{ path('recurring_scheduler_create') }}" class="btn btn-primary btn-lg pull-right" role="button">
        {{ "schedule.action.recurring_new"|trans }}
    </a>
    <a href="{{ path('recurring_scheduler_create') }}" class="btn btn-primary btn-lg pull-right" role="button">
        {{ "schedule.action.onetime_new"|trans }}
    </a>
{% endblock content %}
